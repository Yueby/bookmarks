"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const vue_1 = require("vue");
const utils_1 = require("../../utils");
const validation_1 = require("../../utils/validation");
/**
 * 分组管理器组件
 */
exports.default = (0, vue_1.defineComponent)({
    name: 'GroupManager',
    props: {
        groups: {
            type: Array,
            required: true
        },
        currentGroup: {
            type: Object,
            default: null
        }
    },
    emits: ['update:groups', 'update:currentGroup'],
    data() {
        return {
            showInput: false,
            newGroupName: '',
            dragState: '',
            dragIndex: -1
        };
    },
    computed: {
        sortedGroups() {
            return [...this.groups].sort((a, b) => a.order - b.order);
        }
    },
    methods: {
        /**
         * 添加分组
         */
        addGroup() {
            if (!this.newGroupName)
                return;
            if (!(0, validation_1.validateGroupName)(this.newGroupName)) {
                Editor.Dialog.warn('分组名称不能为空且长度不能超过20个字符');
                return;
            }
            const group = {
                id: (0, utils_1.generateId)(),
                name: this.newGroupName,
                bookmarkList: [],
                order: this.groups.length,
                createTime: Date.now(),
                updateTime: Date.now()
            };
            const newGroups = [...this.groups, group];
            this.$emit('update:groups', newGroups);
            this.newGroupName = '';
            this.showInput = false;
        },
        /**
         * 删除分组
         */
        removeGroup(group) {
            var _a;
            const newGroups = this.groups.filter(g => g.id !== group.id);
            this.$emit('update:groups', newGroups);
            if (((_a = this.currentGroup) === null || _a === void 0 ? void 0 : _a.id) === group.id) {
                this.$emit('update:currentGroup', null);
            }
        },
        /**
         * 切换分组
         */
        switchGroup(group) {
            this.$emit('update:currentGroup', group);
        },
        /**
         * 开始拖拽分组
         */
        dragStartGroup(event, group) {
            if (!event.dataTransfer)
                return;
            event.dataTransfer.setData('group-id', group.id);
            event.dataTransfer.effectAllowed = 'move';
            const target = event.target;
            target.classList.add('dragging');
            this.dragState = 'group';
            this.dragIndex = this.groups.findIndex(g => g.id === group.id);
        },
        /**
         * 拖拽结束
         */
        dragEndGroup(event) {
            const target = event.target;
            target.classList.remove('dragging');
            this.dragState = '';
            this.dragIndex = -1;
        },
        /**
         * 处理拖拽放置
         */
        async dropGroup(event, targetGroup) {
            event.preventDefault();
            if (!event.dataTransfer)
                return;
            try {
                const sourceId = event.dataTransfer.getData('group-id');
                if (!sourceId || sourceId === targetGroup.id)
                    return;
                const sourceIndex = this.groups.findIndex(g => g.id === sourceId);
                const targetIndex = this.groups.findIndex(g => g.id === targetGroup.id);
                if (sourceIndex > -1 && targetIndex > -1) {
                    const newGroups = [...this.groups];
                    const [movedGroup] = newGroups.splice(sourceIndex, 1);
                    newGroups.splice(targetIndex, 0, movedGroup);
                    // 更新排序
                    newGroups.forEach((group, index) => {
                        group.order = index;
                    });
                    this.$emit('update:groups', newGroups);
                }
            }
            catch (err) {
                (0, utils_1.handleError)(err, '移动分组失败');
            }
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zb3VyY2UvcGFuZWxzL3NoYXJlZC9jb21wb25lbnRzL2dyb3VwLW1hbmFnZXIvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw2QkFBc0M7QUFDdEMsdUNBQXNEO0FBQ3RELHVEQUEyRDtBQUczRDs7R0FFRztBQUNILGtCQUFlLElBQUEscUJBQWUsRUFBQztJQUMzQixJQUFJLEVBQUUsY0FBYztJQUNwQixLQUFLLEVBQUU7UUFDSCxNQUFNLEVBQUU7WUFDSixJQUFJLEVBQUUsS0FBeUM7WUFDL0MsUUFBUSxFQUFFLElBQUk7U0FDakI7UUFDRCxZQUFZLEVBQUU7WUFDVixJQUFJLEVBQUUsTUFBNkM7WUFDbkQsT0FBTyxFQUFFLElBQUk7U0FDaEI7S0FDSjtJQUNELEtBQUssRUFBRSxDQUFDLGVBQWUsRUFBRSxxQkFBcUIsQ0FBQztJQUMvQyxJQUFJO1FBQ0EsT0FBTztZQUNILFNBQVMsRUFBRSxLQUFLO1lBQ2hCLFlBQVksRUFBRSxFQUFFO1lBQ2hCLFNBQVMsRUFBRSxFQUFFO1lBQ2IsU0FBUyxFQUFFLENBQUMsQ0FBQztTQUNoQixDQUFDO0lBQ04sQ0FBQztJQUNELFFBQVEsRUFBRTtRQUNOLFlBQVk7WUFDUixPQUFPLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDOUQsQ0FBQztLQUNKO0lBQ0QsT0FBTyxFQUFFO1FBQ0w7O1dBRUc7UUFDSCxRQUFRO1lBQ0osSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZO2dCQUFFLE9BQU87WUFFL0IsSUFBSSxDQUFDLElBQUEsOEJBQWlCLEVBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFO2dCQUN2QyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO2dCQUMzQyxPQUFPO2FBQ1Y7WUFFRCxNQUFNLEtBQUssR0FBRztnQkFDVixFQUFFLEVBQUUsSUFBQSxrQkFBVSxHQUFFO2dCQUNoQixJQUFJLEVBQUUsSUFBSSxDQUFDLFlBQVk7Z0JBQ3ZCLFlBQVksRUFBRSxFQUFFO2dCQUNoQixLQUFLLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNO2dCQUN6QixVQUFVLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRTtnQkFDdEIsVUFBVSxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUU7YUFDekIsQ0FBQztZQUVGLE1BQU0sU0FBUyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQzFDLElBQUksQ0FBQyxLQUFLLENBQUMsZUFBZSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBQ3ZDLElBQUksQ0FBQyxZQUFZLEdBQUcsRUFBRSxDQUFDO1lBQ3ZCLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1FBQzNCLENBQUM7UUFFRDs7V0FFRztRQUNILFdBQVcsQ0FBQyxLQUE2Qjs7WUFDckMsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUM3RCxJQUFJLENBQUMsS0FBSyxDQUFDLGVBQWUsRUFBRSxTQUFTLENBQUMsQ0FBQztZQUN2QyxJQUFJLENBQUEsTUFBQSxJQUFJLENBQUMsWUFBWSwwQ0FBRSxFQUFFLE1BQUssS0FBSyxDQUFDLEVBQUUsRUFBRTtnQkFDcEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsRUFBRSxJQUFJLENBQUMsQ0FBQzthQUMzQztRQUNMLENBQUM7UUFFRDs7V0FFRztRQUNILFdBQVcsQ0FBQyxLQUE2QjtZQUNyQyxJQUFJLENBQUMsS0FBSyxDQUFDLHFCQUFxQixFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzdDLENBQUM7UUFFRDs7V0FFRztRQUNILGNBQWMsQ0FBQyxLQUFnQixFQUFFLEtBQTZCO1lBQzFELElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWTtnQkFBRSxPQUFPO1lBRWhDLEtBQUssQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDakQsS0FBSyxDQUFDLFlBQVksQ0FBQyxhQUFhLEdBQUcsTUFBTSxDQUFDO1lBRTFDLE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxNQUFxQixDQUFDO1lBQzNDLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRWpDLElBQUksQ0FBQyxTQUFTLEdBQUcsT0FBTyxDQUFDO1lBQ3pCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNuRSxDQUFDO1FBRUQ7O1dBRUc7UUFDSCxZQUFZLENBQUMsS0FBZ0I7WUFDekIsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQXFCLENBQUM7WUFDM0MsTUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDcEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7WUFDcEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUN4QixDQUFDO1FBRUQ7O1dBRUc7UUFDSCxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQWdCLEVBQUUsV0FBbUM7WUFDakUsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ3ZCLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWTtnQkFBRSxPQUFPO1lBRWhDLElBQUk7Z0JBQ0EsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQ3hELElBQUksQ0FBQyxRQUFRLElBQUksUUFBUSxLQUFLLFdBQVcsQ0FBQyxFQUFFO29CQUFFLE9BQU87Z0JBRXJELE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxRQUFRLENBQUMsQ0FBQztnQkFDbEUsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFFeEUsSUFBSSxXQUFXLEdBQUcsQ0FBQyxDQUFDLElBQUksV0FBVyxHQUFHLENBQUMsQ0FBQyxFQUFFO29CQUN0QyxNQUFNLFNBQVMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUNuQyxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUM7b0JBQ3RELFNBQVMsQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLENBQUMsRUFBRSxVQUFVLENBQUMsQ0FBQztvQkFFN0MsT0FBTztvQkFDUCxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxFQUFFO3dCQUMvQixLQUFLLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztvQkFDeEIsQ0FBQyxDQUFDLENBQUM7b0JBRUgsSUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFlLEVBQUUsU0FBUyxDQUFDLENBQUM7aUJBQzFDO2FBQ0o7WUFBQyxPQUFPLEdBQUcsRUFBRTtnQkFDVixJQUFBLG1CQUFXLEVBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxDQUFDO2FBQzlCO1FBQ0wsQ0FBQztLQUNKO0NBQ0osQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVmaW5lQ29tcG9uZW50IH0gZnJvbSAndnVlJztcbmltcG9ydCB7IGdlbmVyYXRlSWQsIGhhbmRsZUVycm9yIH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xuaW1wb3J0IHsgdmFsaWRhdGVHcm91cE5hbWUgfSBmcm9tICcuLi8uLi91dGlscy92YWxpZGF0aW9uJztcbmltcG9ydCB7IEFzc2V0R3JvdXAsIE5vZGVHcm91cCB9IGZyb20gJy4uLy4uL3R5cGVzJztcblxuLyoqXG4gKiDliIbnu4TnrqHnkIblmajnu4Tku7ZcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZGVmaW5lQ29tcG9uZW50KHtcbiAgICBuYW1lOiAnR3JvdXBNYW5hZ2VyJyxcbiAgICBwcm9wczoge1xuICAgICAgICBncm91cHM6IHtcbiAgICAgICAgICAgIHR5cGU6IEFycmF5IGFzICgpID0+IChBc3NldEdyb3VwIHwgTm9kZUdyb3VwKVtdLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgY3VycmVudEdyb3VwOiB7XG4gICAgICAgICAgICB0eXBlOiBPYmplY3QgYXMgKCkgPT4gQXNzZXRHcm91cCB8IE5vZGVHcm91cCB8IG51bGwsXG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsXG4gICAgICAgIH1cbiAgICB9LFxuICAgIGVtaXRzOiBbJ3VwZGF0ZTpncm91cHMnLCAndXBkYXRlOmN1cnJlbnRHcm91cCddLFxuICAgIGRhdGEoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzaG93SW5wdXQ6IGZhbHNlLFxuICAgICAgICAgICAgbmV3R3JvdXBOYW1lOiAnJyxcbiAgICAgICAgICAgIGRyYWdTdGF0ZTogJycsXG4gICAgICAgICAgICBkcmFnSW5kZXg6IC0xXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBjb21wdXRlZDoge1xuICAgICAgICBzb3J0ZWRHcm91cHMoKTogKEFzc2V0R3JvdXAgfCBOb2RlR3JvdXApW10ge1xuICAgICAgICAgICAgcmV0dXJuIFsuLi50aGlzLmdyb3Vwc10uc29ydCgoYSwgYikgPT4gYS5vcmRlciAtIGIub3JkZXIpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBtZXRob2RzOiB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDmt7vliqDliIbnu4RcbiAgICAgICAgICovXG4gICAgICAgIGFkZEdyb3VwKCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLm5ld0dyb3VwTmFtZSkgcmV0dXJuO1xuXG4gICAgICAgICAgICBpZiAoIXZhbGlkYXRlR3JvdXBOYW1lKHRoaXMubmV3R3JvdXBOYW1lKSkge1xuICAgICAgICAgICAgICAgIEVkaXRvci5EaWFsb2cud2Fybign5YiG57uE5ZCN56ew5LiN6IO95Li656m65LiU6ZW/5bqm5LiN6IO96LaF6L+HMjDkuKrlrZfnrKYnKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGdyb3VwID0ge1xuICAgICAgICAgICAgICAgIGlkOiBnZW5lcmF0ZUlkKCksXG4gICAgICAgICAgICAgICAgbmFtZTogdGhpcy5uZXdHcm91cE5hbWUsXG4gICAgICAgICAgICAgICAgYm9va21hcmtMaXN0OiBbXSxcbiAgICAgICAgICAgICAgICBvcmRlcjogdGhpcy5ncm91cHMubGVuZ3RoLFxuICAgICAgICAgICAgICAgIGNyZWF0ZVRpbWU6IERhdGUubm93KCksXG4gICAgICAgICAgICAgICAgdXBkYXRlVGltZTogRGF0ZS5ub3coKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgbmV3R3JvdXBzID0gWy4uLnRoaXMuZ3JvdXBzLCBncm91cF07XG4gICAgICAgICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6Z3JvdXBzJywgbmV3R3JvdXBzKTtcbiAgICAgICAgICAgIHRoaXMubmV3R3JvdXBOYW1lID0gJyc7XG4gICAgICAgICAgICB0aGlzLnNob3dJbnB1dCA9IGZhbHNlO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiDliKDpmaTliIbnu4RcbiAgICAgICAgICovXG4gICAgICAgIHJlbW92ZUdyb3VwKGdyb3VwOiBBc3NldEdyb3VwIHwgTm9kZUdyb3VwKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdHcm91cHMgPSB0aGlzLmdyb3Vwcy5maWx0ZXIoZyA9PiBnLmlkICE9PSBncm91cC5pZCk7XG4gICAgICAgICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6Z3JvdXBzJywgbmV3R3JvdXBzKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRHcm91cD8uaWQgPT09IGdyb3VwLmlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOmN1cnJlbnRHcm91cCcsIG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiDliIfmjaLliIbnu4RcbiAgICAgICAgICovXG4gICAgICAgIHN3aXRjaEdyb3VwKGdyb3VwOiBBc3NldEdyb3VwIHwgTm9kZUdyb3VwKSB7XG4gICAgICAgICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6Y3VycmVudEdyb3VwJywgZ3JvdXApO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlvIDlp4vmi5bmi73liIbnu4RcbiAgICAgICAgICovXG4gICAgICAgIGRyYWdTdGFydEdyb3VwKGV2ZW50OiBEcmFnRXZlbnQsIGdyb3VwOiBBc3NldEdyb3VwIHwgTm9kZUdyb3VwKSB7XG4gICAgICAgICAgICBpZiAoIWV2ZW50LmRhdGFUcmFuc2ZlcikgcmV0dXJuO1xuXG4gICAgICAgICAgICBldmVudC5kYXRhVHJhbnNmZXIuc2V0RGF0YSgnZ3JvdXAtaWQnLCBncm91cC5pZCk7XG4gICAgICAgICAgICBldmVudC5kYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9ICdtb3ZlJztcblxuICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xuICAgICAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ2RyYWdnaW5nJyk7XG5cbiAgICAgICAgICAgIHRoaXMuZHJhZ1N0YXRlID0gJ2dyb3VwJztcbiAgICAgICAgICAgIHRoaXMuZHJhZ0luZGV4ID0gdGhpcy5ncm91cHMuZmluZEluZGV4KGcgPT4gZy5pZCA9PT0gZ3JvdXAuaWQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiDmi5bmi73nu5PmnZ9cbiAgICAgICAgICovXG4gICAgICAgIGRyYWdFbmRHcm91cChldmVudDogRHJhZ0V2ZW50KSB7XG4gICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgICAgICB0YXJnZXQuY2xhc3NMaXN0LnJlbW92ZSgnZHJhZ2dpbmcnKTtcbiAgICAgICAgICAgIHRoaXMuZHJhZ1N0YXRlID0gJyc7XG4gICAgICAgICAgICB0aGlzLmRyYWdJbmRleCA9IC0xO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlpITnkIbmi5bmi73mlL7nva5cbiAgICAgICAgICovXG4gICAgICAgIGFzeW5jIGRyb3BHcm91cChldmVudDogRHJhZ0V2ZW50LCB0YXJnZXRHcm91cDogQXNzZXRHcm91cCB8IE5vZGVHcm91cCkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGlmICghZXZlbnQuZGF0YVRyYW5zZmVyKSByZXR1cm47XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc291cmNlSWQgPSBldmVudC5kYXRhVHJhbnNmZXIuZ2V0RGF0YSgnZ3JvdXAtaWQnKTtcbiAgICAgICAgICAgICAgICBpZiAoIXNvdXJjZUlkIHx8IHNvdXJjZUlkID09PSB0YXJnZXRHcm91cC5pZCkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgY29uc3Qgc291cmNlSW5kZXggPSB0aGlzLmdyb3Vwcy5maW5kSW5kZXgoZyA9PiBnLmlkID09PSBzb3VyY2VJZCk7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0SW5kZXggPSB0aGlzLmdyb3Vwcy5maW5kSW5kZXgoZyA9PiBnLmlkID09PSB0YXJnZXRHcm91cC5pZCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoc291cmNlSW5kZXggPiAtMSAmJiB0YXJnZXRJbmRleCA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0dyb3VwcyA9IFsuLi50aGlzLmdyb3Vwc107XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IFttb3ZlZEdyb3VwXSA9IG5ld0dyb3Vwcy5zcGxpY2Uoc291cmNlSW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgICAgICBuZXdHcm91cHMuc3BsaWNlKHRhcmdldEluZGV4LCAwLCBtb3ZlZEdyb3VwKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyDmm7TmlrDmjpLluo9cbiAgICAgICAgICAgICAgICAgICAgbmV3R3JvdXBzLmZvckVhY2goKGdyb3VwLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXAub3JkZXIgPSBpbmRleDtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOmdyb3VwcycsIG5ld0dyb3Vwcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlRXJyb3IoZXJyLCAn56e75Yqo5YiG57uE5aSx6LSlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KTsgIl19