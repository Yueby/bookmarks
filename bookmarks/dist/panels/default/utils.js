"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getNodePath = exports.getAssetIcon = exports.validateAdditionalItems = exports.validateAdditionalItem = exports.createAdditionalItem = exports.validateGroup = exports.validateMark = exports.findMarkInGroups = exports.findGroupById = exports.sortGroups = exports.normalizePath = exports.isImageFile = exports.isMarkItem = exports.isGroup = exports.deepClone = exports.sortByOrder = exports.validateGroupName = exports.formatDate = exports.handleError = exports.generateId = exports.debounce = void 0;
const types_1 = require("../shared/types");
const icons_1 = require("../shared/constants/icons");
function debounce(fn, delay) {
    let timer = null;
    return function (...args) {
        if (timer)
            clearTimeout(timer);
        timer = setTimeout(() => {
            fn.apply(this, args);
            timer = null;
        }, delay);
    };
}
exports.debounce = debounce;
function generateId() {
    return Date.now().toString(36) + Math.random().toString(36).substr(2);
}
exports.generateId = generateId;
function handleError(error, message) {
    console.error(message, error);
    Editor.Dialog.error('错误', {
        detail: message + '\n' + (error.message || error)
    });
}
exports.handleError = handleError;
function formatDate(timestamp) {
    return new Date(timestamp).toLocaleString();
}
exports.formatDate = formatDate;
function validateGroupName(name) {
    return name.trim().length > 0 && name.length <= 20;
}
exports.validateGroupName = validateGroupName;
function sortByOrder(items) {
    return [...items].sort((a, b) => a.order - b.order);
}
exports.sortByOrder = sortByOrder;
function deepClone(obj) {
    return JSON.parse(JSON.stringify(obj));
}
exports.deepClone = deepClone;
function isGroup(obj) {
    return obj && typeof obj === 'object' && typeof obj.id === 'string' && typeof obj.name === 'string' && Array.isArray(obj.bookmarkList);
}
exports.isGroup = isGroup;
function isMarkItem(obj) {
    return obj && typeof obj === 'object' && typeof obj.name === 'string' && typeof obj.uuid === 'string';
}
exports.isMarkItem = isMarkItem;
function isImageFile(extname) {
    return ['png', 'jpg', 'jpeg'].includes(extname.toLowerCase());
}
exports.isImageFile = isImageFile;
function normalizePath(path) {
    return path.replace(/\\/g, '/');
}
exports.normalizePath = normalizePath;
function sortGroups(groups, order = types_1.SortOrder.ASC) {
    return [...groups].sort((a, b) => {
        const result = a.order - b.order;
        return order === types_1.SortOrder.ASC ? result : -result;
    });
}
exports.sortGroups = sortGroups;
function findGroupById(groups, id) {
    return groups.find((group) => group.id === id);
}
exports.findGroupById = findGroupById;
function findMarkInGroups(groups, uuid) {
    for (const group of groups) {
        const mark = group.bookmarkList.find((item) => item.uuid === uuid);
        if (mark) {
            return { group, mark };
        }
    }
    return undefined;
}
exports.findMarkInGroups = findMarkInGroups;
function validateMark(mark) {
    return typeof mark === 'object' && typeof mark.name === 'string' && typeof mark.uuid === 'string' && typeof mark.assetType === 'string';
}
exports.validateMark = validateMark;
function validateGroup(group) {
    return (typeof group === 'object' && typeof group.id === 'string' && typeof group.name === 'string' && Array.isArray(group.bookmarkList) && group.bookmarkList.every(validateMark));
}
exports.validateGroup = validateGroup;
function createAdditionalItem(type, value, name) {
    return { type, value, name };
}
exports.createAdditionalItem = createAdditionalItem;
function validateAdditionalItem(item) {
    return item && typeof item === 'object' && typeof item.type === 'string' && typeof item.value === 'string' && typeof item.name === 'string';
}
exports.validateAdditionalItem = validateAdditionalItem;
function validateAdditionalItems(items) {
    return Array.isArray(items) && items.every(validateAdditionalItem);
}
exports.validateAdditionalItems = validateAdditionalItems;
// 获取资源图标
function getAssetIcon(extName, type) {
    // 先尝试从扩展名映射获取
    const extIcon = icons_1.extMap[extName];
    if (extIcon) {
        return extIcon;
    }
    // 再尝试从类型映射获取
    const typeIcon = icons_1.typeMap[type];
    if (typeIcon) {
        return typeIcon;
    }
    // 如果都没有找到，返回默认图标
    return 'custom-asset';
}
exports.getAssetIcon = getAssetIcon;
// 获取节点路径
async function getNodePath(uuid) {
    var _a;
    const paths = [];
    let currentUuid = uuid;
    while (currentUuid) {
        const nodeInfo = await Editor.Message.request('scene', 'query-node', currentUuid);
        if (!nodeInfo)
            break;
        const nodeName = ((_a = nodeInfo.name) === null || _a === void 0 ? void 0 : _a.value) || 'Unknown';
        paths.unshift(nodeName);
        currentUuid = nodeInfo.parent || '';
    }
    return paths.join('/');
}
exports.getNodePath = getNodePath;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zb3VyY2UvcGFuZWxzL2RlZmF1bHQvdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsMkNBQTJIO0FBQzNILHFEQUFzRTtBQUV0RSxTQUFnQixRQUFRLENBQUMsRUFBWSxFQUFFLEtBQWE7SUFDbkQsSUFBSSxLQUFLLEdBQXlDLElBQUksQ0FBQztJQUN2RCxPQUFPLFVBQXFCLEdBQUcsSUFBVztRQUN6QyxJQUFJLEtBQUs7WUFBRSxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDL0IsS0FBSyxHQUFHLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDdkIsRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDckIsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNkLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNYLENBQUMsQ0FBQztBQUNILENBQUM7QUFURCw0QkFTQztBQUVELFNBQWdCLFVBQVU7SUFDekIsT0FBTyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3ZFLENBQUM7QUFGRCxnQ0FFQztBQUVELFNBQWdCLFdBQVcsQ0FBQyxLQUFVLEVBQUUsT0FBZTtJQUN0RCxPQUFPLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztJQUM5QixNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUU7UUFDekIsTUFBTSxFQUFFLE9BQU8sR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxJQUFJLEtBQUssQ0FBQztLQUNqRCxDQUFDLENBQUM7QUFDSixDQUFDO0FBTEQsa0NBS0M7QUFFRCxTQUFnQixV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c0NvbnRlbnQiOlsiaW1wb3J0IHsgQWRkaXRpb25hbEl0ZW0sIEFzc2V0R3JvdXAsIEFzc2V0Qm9va21hcmssIE5vZGVHcm91cCwgTm9kZUJvb2ttYXJrLCAgU29ydE9yZGVyLCBPcHRpb25hbCB9IGZyb20gJy4uL3NoYXJlZC90eXBlcyc7XHJcbmltcG9ydCB7IGV4dE1hcCwgdHlwZU1hcCwgSWNvblR5cGUgfSBmcm9tICcuLi9zaGFyZWQvY29uc3RhbnRzL2ljb25zJztcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWJvdW5jZShmbjogRnVuY3Rpb24sIGRlbGF5OiBudW1iZXIpIHtcclxuXHRsZXQgdGltZXI6IFJldHVyblR5cGU8dHlwZW9mIHNldFRpbWVvdXQ+IHwgbnVsbCA9IG51bGw7XHJcblx0cmV0dXJuIGZ1bmN0aW9uICh0aGlzOiBhbnksIC4uLmFyZ3M6IGFueVtdKSB7XHJcblx0XHRpZiAodGltZXIpIGNsZWFyVGltZW91dCh0aW1lcik7XHJcblx0XHR0aW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG5cdFx0XHRmbi5hcHBseSh0aGlzLCBhcmdzKTtcclxuXHRcdFx0dGltZXIgPSBudWxsO1xyXG5cdFx0fSwgZGVsYXkpO1xyXG5cdH07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUlkKCk6IHN0cmluZyB7XHJcblx0cmV0dXJuIERhdGUubm93KCkudG9TdHJpbmcoMzYpICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlRXJyb3IoZXJyb3I6IGFueSwgbWVzc2FnZTogc3RyaW5nKSB7XHJcblx0Y29uc29sZS5lcnJvcihtZXNzYWdlLCBlcnJvcik7XHJcblx0RWRpdG9yLkRpYWxvZy5lcnJvcign6ZSZ6K+vJywge1xyXG5cdFx0ZGV0YWlsOiBtZXNzYWdlICsgJ1xcbicgKyAoZXJyb3IubWVzc2FnZSB8fCBlcnJvcilcclxuXHR9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdERhdGUodGltZXN0YW1wOiBudW1iZXIpOiBzdHJpbmcge1xyXG5cdHJldHVybiBuZXcgRGF0ZSh0aW1lc3RhbXApLnRvTG9jYWxlU3RyaW5nKCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUdyb3VwTmFtZShuYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcclxuXHRyZXR1cm4gbmFtZS50cmltKCkubGVuZ3RoID4gMCAmJiBuYW1lLmxlbmd0aCA8PSAyMDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNvcnRCeU9yZGVyPFQgZXh0ZW5kcyB7IG9yZGVyOiBudW1iZXIgfT4oaXRlbXM6IFRbXSk6IFRbXSB7XHJcblx0cmV0dXJuIFsuLi5pdGVtc10uc29ydCgoYSwgYikgPT4gYS5vcmRlciAtIGIub3JkZXIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGVlcENsb25lPFQ+KG9iajogVCk6IFQge1xyXG5cdHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNHcm91cChvYmo6IGFueSk6IG9iaiBpcyBBc3NldEdyb3VwIHtcclxuXHRyZXR1cm4gb2JqICYmIHR5cGVvZiBvYmogPT09ICdvYmplY3QnICYmIHR5cGVvZiBvYmouaWQgPT09ICdzdHJpbmcnICYmIHR5cGVvZiBvYmoubmFtZSA9PT0gJ3N0cmluZycgJiYgQXJyYXkuaXNBcnJheShvYmouYm9va21hcmtMaXN0KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzTWFya0l0ZW0ob2JqOiBhbnkpOiBvYmogaXMgQXNzZXRCb29rbWFyayB7XHJcblx0cmV0dXJuIG9iaiAmJiB0eXBlb2Ygb2JqID09PSAnb2JqZWN0JyAmJiB0eXBlb2Ygb2JqLm5hbWUgPT09ICdzdHJpbmcnICYmIHR5cGVvZiBvYmoudXVpZCA9PT0gJ3N0cmluZyc7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0ltYWdlRmlsZShleHRuYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcclxuXHRyZXR1cm4gWydwbmcnLCAnanBnJywgJ2pwZWcnXS5pbmNsdWRlcyhleHRuYW1lLnRvTG93ZXJDYXNlKCkpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplUGF0aChwYXRoOiBzdHJpbmcpOiBzdHJpbmcge1xyXG5cdHJldHVybiBwYXRoLnJlcGxhY2UoL1xcXFwvZywgJy8nKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNvcnRHcm91cHMoZ3JvdXBzOiBBc3NldEdyb3VwW10sIG9yZGVyOiBTb3J0T3JkZXIgPSBTb3J0T3JkZXIuQVNDKTogQXNzZXRHcm91cFtdIHtcclxuXHRyZXR1cm4gWy4uLmdyb3Vwc10uc29ydCgoYSwgYikgPT4ge1xyXG5cdFx0Y29uc3QgcmVzdWx0ID0gYS5vcmRlciAtIGIub3JkZXI7XHJcblx0XHRyZXR1cm4gb3JkZXIgPT09IFNvcnRPcmRlci5BU0MgPyByZXN1bHQgOiAtcmVzdWx0O1xyXG5cdH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZmluZEdyb3VwQnlJZChncm91cHM6IEFzc2V0R3JvdXBbXSwgaWQ6IHN0cmluZyk6IE9wdGlvbmFsPEFzc2V0R3JvdXA+IHtcclxuXHRyZXR1cm4gZ3JvdXBzLmZpbmQoKGdyb3VwKSA9PiBncm91cC5pZCA9PT0gaWQpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZmluZE1hcmtJbkdyb3Vwcyhncm91cHM6IEFzc2V0R3JvdXBbXSwgdXVpZDogc3RyaW5nKTogeyBncm91cDogQXNzZXRHcm91cDsgbWFyazogQXNzZXRCb29rbWFyayB9IHwgdW5kZWZpbmVkIHtcclxuXHRmb3IgKGNvbnN0IGdyb3VwIG9mIGdyb3Vwcykge1xyXG5cdFx0Y29uc3QgbWFyayA9IGdyb3VwLmJvb2ttYXJrTGlzdC5maW5kKChpdGVtKSA9PiBpdGVtLnV1aWQgPT09IHV1aWQpO1xyXG5cdFx0aWYgKG1hcmspIHtcclxuXHRcdFx0cmV0dXJuIHsgZ3JvdXAsIG1hcmsgfTtcclxuXHRcdH1cclxuXHR9XHJcblx0cmV0dXJuIHVuZGVmaW5lZDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlTWFyayhtYXJrOiBhbnkpOiBtYXJrIGlzIEFzc2V0Qm9va21hcmsge1xyXG5cdHJldHVybiB0eXBlb2YgbWFyayA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1hcmsubmFtZSA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIG1hcmsudXVpZCA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIG1hcmsuYXNzZXRUeXBlID09PSAnc3RyaW5nJztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlR3JvdXAoZ3JvdXA6IGFueSk6IGdyb3VwIGlzIEFzc2V0R3JvdXAge1xyXG5cdHJldHVybiAoXHJcblx0XHR0eXBlb2YgZ3JvdXAgPT09ICdvYmplY3QnICYmIHR5cGVvZiBncm91cC5pZCA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIGdyb3VwLm5hbWUgPT09ICdzdHJpbmcnICYmIEFycmF5LmlzQXJyYXkoZ3JvdXAuYm9va21hcmtMaXN0KSAmJiBncm91cC5ib29rbWFya0xpc3QuZXZlcnkodmFsaWRhdGVNYXJrKVxyXG5cdCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVBZGRpdGlvbmFsSXRlbSh0eXBlOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcsIG5hbWU6IHN0cmluZyk6IEFkZGl0aW9uYWxJdGVtIHtcclxuXHRyZXR1cm4geyB0eXBlLCB2YWx1ZSwgbmFtZSB9O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVBZGRpdGlvbmFsSXRlbShpdGVtOiBhbnkpOiBpdGVtIGlzIEFkZGl0aW9uYWxJdGVtIHtcclxuXHRyZXR1cm4gaXRlbSAmJiB0eXBlb2YgaXRlbSA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIGl0ZW0udHlwZSA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIGl0ZW0udmFsdWUgPT09ICdzdHJpbmcnICYmIHR5cGVvZiBpdGVtLm5hbWUgPT09ICdzdHJpbmcnO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVBZGRpdGlvbmFsSXRlbXMoaXRlbXM6IGFueVtdKTogaXRlbXMgaXMgQWRkaXRpb25hbEl0ZW1bXSB7XHJcblx0cmV0dXJuIEFycmF5LmlzQXJyYXkoaXRlbXMpICYmIGl0ZW1zLmV2ZXJ5KHZhbGlkYXRlQWRkaXRpb25hbEl0ZW0pO1xyXG59XHJcblxyXG4vLyDojrflj5botYTmupDlm77moIdcclxuZXhwb3J0IGZ1bmN0aW9uIGdldEFzc2V0SWNvbihleHROYW1lOiBzdHJpbmcsIHR5cGU6IHN0cmluZyk6IEljb25UeXBlIHtcclxuXHQvLyDlhYjlsJ3or5Xku47mianlsZXlkI3mmKDlsITojrflj5ZcclxuXHRjb25zdCBleHRJY29uID0gZXh0TWFwW2V4dE5hbWVdO1xyXG5cdGlmIChleHRJY29uKSB7XHJcblx0XHRyZXR1cm4gZXh0SWNvbjtcclxuXHR9XHJcblxyXG5cdC8vIOWGjeWwneivleS7juexu+Wei+aYoOWwhOiOt+WPllxyXG5cdGNvbnN0IHR5cGVJY29uID0gdHlwZU1hcFt0eXBlXTtcclxuXHRpZiAodHlwZUljb24pIHtcclxuXHRcdHJldHVybiB0eXBlSWNvbjtcclxuXHR9XHJcblxyXG5cdC8vIOWmguaenOmDveayoeacieaJvuWIsO+8jOi/lOWbnum7mOiupOWbvuagh1xyXG5cdHJldHVybiAnY3VzdG9tLWFzc2V0JztcclxufVxyXG5cclxuLy8g6I635Y+W6IqC54K56Lev5b6EXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb2RlUGF0aCh1dWlkOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xyXG5cdGNvbnN0IHBhdGhzOiBzdHJpbmdbXSA9IFtdO1xyXG5cdGxldCBjdXJyZW50VXVpZCA9IHV1aWQ7XHJcblxyXG5cdHdoaWxlIChjdXJyZW50VXVpZCkge1xyXG5cdFx0Y29uc3Qgbm9kZUluZm8gPSBhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdxdWVyeS1ub2RlJywgY3VycmVudFV1aWQpO1xyXG5cdFx0aWYgKCFub2RlSW5mbykgYnJlYWs7XHJcblxyXG5cdFx0Y29uc3Qgbm9kZU5hbWUgPSAobm9kZUluZm8ubmFtZT8udmFsdWUgYXMgc3RyaW5nKSB8fCAnVW5rbm93bic7XHJcblx0XHRwYXRocy51bnNoaWZ0KG5vZGVOYW1lKTtcclxuXHJcblx0XHRjdXJyZW50VXVpZCA9IChub2RlSW5mby5wYXJlbnQgYXMgc3RyaW5nKSB8fCAnJztcclxuXHR9XHJcblxyXG5cdHJldHVybiBwYXRocy5qb2luKCcvJyk7XHJcbn1cclxuIl19